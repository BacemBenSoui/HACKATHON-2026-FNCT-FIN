
-- 1. STRUCTURE : Ajout de la colonne pour le dossier de motivation (PDF)
ALTER TABLE public.teams ADD COLUMN IF NOT EXISTS motivation_url text;

-- 2. SECURITÉ : Nettoyage radical des anciennes politiques conflictuelles
DROP POLICY IF EXISTS "Leaders can update their own team" ON public.teams;
DROP POLICY IF EXISTS "Allow authenticated update" ON public.teams;
DROP POLICY IF EXISTS "Enable update for all authenticated users" ON public.teams;
DROP POLICY IF EXISTS "Enable all for authenticated users" ON public.teams;

-- 3. POLITIQUE UNIVERSELLE (Prototype FNCT 2026)
-- Autorise SELECT, INSERT, UPDATE par tout utilisateur authentifié pour simplifier le prototype
-- Cela inclut spécifiquement la permission de changer le champ 'status' de 'incomplete' à 'submitted'
CREATE POLICY "Enable all for authenticated users" 
ON public.teams 
FOR ALL 
TO authenticated 
USING (true) 
WITH CHECK (true);

-- Active le RLS pour la table teams
ALTER TABLE public.teams ENABLE ROW LEVEL SECURITY;
